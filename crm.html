<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CRM LocalStorage - AMR ADV</title>
<style>
/* --- Layout --- */
*{box-sizing:border-box;margin:0;padding:0;font-family:Segoe UI,Roboto,Arial,sans-serif}
body{display:flex;height:100vh;background:#f0f2f5}
.sidebar{width:220px;background:#fff;border-right:1px solid #ddd;display:flex;flex-direction:column;padding:20px 10px}
.sidebar h2{text-align:center;margin-bottom:12px;color:#1e1e2f}
.sidebar button{padding:10px;border-radius:6px;border:0;background:#f8f9fa;margin:6px;cursor:pointer}
.main{flex:1;display:flex;flex-direction:column}
header{height:60px;background:#fff;border-bottom:1px solid #ddd;display:flex;align-items:center;justify-content:space-between;padding:0 20px}
.search-bar{padding:10px 20px;background:#fff;border-bottom:1px solid #ddd;display:flex;gap:10px;align-items:center}
.search-bar input{flex:1;padding:8px;border-radius:6px;border:1px solid #ccc}
.search-bar select{padding:8px;border-radius:6px;border:1px solid #ccc}
.kanban{display:flex;gap:20px;padding:20px;overflow:auto;flex:1}
.column{background:#fff;border-radius:10px;padding:15px;min-width:260px;max-height:calc(100vh - 160px);display:flex;flex-direction:column;gap:10px;box-shadow:0 4px 8px rgba(0,0,0,.04)}
.column h2{font-size:16px;color:#1e1e2f;margin-bottom:6px}
/* --- Cards --- */
.card{padding:12px;border-radius:8px;color:#fff;position:relative;cursor:grab}
.card h3{font-size:15px;margin-bottom:6px}
.card p{font-size:13px;margin-bottom:6px;opacity:.95}
.card .meta{font-size:12px;opacity:.85}
.card .actions{position:absolute;top:6px;right:6px;display:flex;gap:6px}
.card button{background:rgba(0,0,0,0.18);border:0;color:#fff;padding:4px 6px;border-radius:4px;cursor:pointer;font-size:12px}
.card button:hover{background:rgba(0,0,0,0.32)}
/* cores */
.prospect{background:#3498db}
.negociacao{background:#f1c40f;color:#000}
.contrato-assinado{background:#9b59b6}
.fechado{background:#2ecc71}
/* --- Modal --- */
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.35);display:none;align-items:center;justify-content:center;z-index:50}
.modal{background:#fff;padding:18px;border-radius:10px;min-width:320px;max-width:420px;box-shadow:0 8px 30px rgba(0,0,0,.25)}
.modal h3{margin-bottom:12px}
.modal .row{margin-bottom:10px}
.modal input,.modal textarea,.modal select{width:100%;padding:8px;border-radius:6px;border:1px solid #ccc}
.modal textarea{min-height:80px;resize:vertical}
.modal .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}
.btn{padding:8px 12px;border-radius:6px;border:0;cursor:pointer}
.btn.primary{background:#1e1e2f;color:#fff}
.btn.ghost{background:#f1f3f5}
/* --- Toast --- */
.toast{position:fixed;right:20px;bottom:20px;background:#222;color:#fff;padding:8px 12px;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,.3);display:none;z-index:60}
</style>
</head>
<body>

<div class="sidebar">
  <h2>AMR ADV</h2>
  <button>Relat√≥rios</button>
  <button>Agenda</button>
  <button>Contatos</button>
  <button>Configura√ß√µes</button>
</div>

<div class="main">
  <header>
    <h1>CRM Local</h1>
    <button id="btnAdd" class="btn primary">Adicionar Cliente</button>
  </header>

  <div class="search-bar">
    <input id="searchInput" placeholder="Buscar cliente..." />
    <select id="filterStatus">
      <option value="">Todos os status</option>
      <option value="prospect">Prospect</option>
      <option value="negociacao">Negocia√ß√£o</option>
      <option value="contrato-assinado">Contrato Assinado</option>
      <option value="fechado">Fechado</option>
    </select>
  </div>

  <main class="kanban" id="kanban">
    <div class="column" id="prospect"><h2>Prospect</h2></div>
    <div class="column" id="negociacao"><h2>Negocia√ß√£o</h2></div>
    <div class="column" id="contrato-assinado"><h2>Contrato Assinado</h2></div>
    <div class="column" id="fechado"><h2>Fechado</h2></div>
  </main>
</div>

<!-- Modal -->
<div class="modal-backdrop" id="modalBackdrop">
  <div class="modal">
    <h3 id="modalTitle">Novo Cliente</h3>
    <form id="clientForm">
      <div class="row">
        <label>Nome</label>
        <input id="inputNome" required />
      </div>
      <div class="row">
        <label>Observa√ß√£o</label>
        <textarea id="inputObs"></textarea>
      </div>
      <div class="row">
        <label>Status</label>
        <select id="inputStatus">
          <option value="prospect">Prospect</option>
          <option value="negociacao">Negocia√ß√£o</option>
          <option value="contrato-assinado">Contrato Assinado</option>
          <option value="fechado">Fechado</option>
        </select>
      </div>
      <div class="actions">
        <button type="button" class="btn ghost" id="btnCancel">Cancelar</button>
        <button type="submit" class="btn primary">Salvar</button>
      </div>
    </form>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
/* ==== Helpers LocalStorage ==== */
function getClientes(){
  return JSON.parse(localStorage.getItem("clientes")||"[]");
}
function saveClientes(clientes){
  localStorage.setItem("clientes", JSON.stringify(clientes));
}

/* ==== DOM ==== */
const STATUS = ['prospect','negociacao','contrato-assinado','fechado'];
let cardsMap = {};
const btnAdd = document.getElementById('btnAdd');
const modalBackdrop = document.getElementById('modalBackdrop');
const clientForm = document.getElementById('clientForm');
const inputNome = document.getElementById('inputNome');
const inputObs = document.getElementById('inputObs');
const inputStatus = document.getElementById('inputStatus');
const btnCancel = document.getElementById('btnCancel');
const searchInput = document.getElementById('searchInput');
const filterStatus = document.getElementById('filterStatus');
const toastEl = document.getElementById('toast');

/* ==== Toast ==== */
function showToast(msg){
  toastEl.innerText = msg;
  toastEl.style.display = 'block';
  clearTimeout(toastEl._t);
  toastEl._t = setTimeout(()=> toastEl.style.display='none', 3000);
}

/* ==== Modal ==== */
function openModal(edit=false, data=null){
  modalBackdrop.style.display = 'flex';
  document.getElementById('modalTitle').innerText = edit ? "Editar Cliente" : "Novo Cliente";
  if(edit && data){
    inputNome.value = data.nome;
    inputObs.value = data.obs;
    inputStatus.value = data.status;
    clientForm.dataset.editId = data.id;
  } else {
    inputNome.value=""; inputObs.value=""; inputStatus.value="prospect";
    delete clientForm.dataset.editId;
  }
}
function closeModal(){ modalBackdrop.style.display='none'; }

/* ==== Criar Card ==== */
function criarCard(cliente){
  const card = document.createElement('div');
  card.className = `card ${cliente.status}`;
  card.draggable = true;
  card.dataset.id = cliente.id;
  card.dataset.status = cliente.status;
  card.dataset.nome = cliente.nome.toLowerCase();

  card.innerHTML = `
    <h3>${cliente.nome}</h3>
    <p>${cliente.obs||''}</p>
    <div class="meta">#${cliente.id}</div>
    <div class="actions">
      <button class="edit">‚úé</button>
      <button class="del">üóë</button>
    </div>
  `;

  addDragEvents(card);

  card.querySelector('.edit').onclick = ()=>openModal(true, cliente);
  card.querySelector('.del').onclick = ()=>deleteCliente(cliente.id);

  document.getElementById(cliente.status).appendChild(card);
  cardsMap[cliente.id] = card;
}

/* ==== Renderizar ==== */
function render(){
  STATUS.forEach(s=>document.getElementById(s).innerHTML=`<h2>${s}</h2>`);
  cardsMap = {};
  getClientes().forEach(c=>criarCard(c));
  filtragemAplicada();
}

/* ==== Adicionar/Editar ==== */
clientForm.onsubmit = e=>{
  e.preventDefault();
  const nome = inputNome.value.trim();
  if(!nome){showToast("Nome obrigat√≥rio");return;}
  const obs = inputObs.value.trim();
  const status = inputStatus.value;
  let clientes = getClientes();
  if(clientForm.dataset.editId){
    const id = clientForm.dataset.editId;
    clientes = clientes.map(c=>c.id===id?{id,nome,obs,status}:c);
    showToast("Cliente atualizado");
  } else {
    const id = Date.now().toString();
    clientes.push({id,nome,obs,status});
    showToast("Cliente adicionado");
  }
  saveClientes(clientes);
  closeModal();
  render();
};

/* ==== Excluir ==== */
function deleteCliente(id){
  if(!confirm("Deseja excluir?")) return;
  const clientes = getClientes().filter(c=>c.id!==id);
  saveClientes(clientes);
  render();
  showToast("Cliente exclu√≠do");
}

/* ==== Drag & Drop ==== */
let draggedCard=null;
function addDragEvents(card){
  card.addEventListener('dragstart', ()=>{draggedCard=card;card.style.opacity=".5";});
  card.addEventListener('dragend', ()=>{if(draggedCard)draggedCard.style.opacity="1";draggedCard=null;});
}
document.querySelectorAll('.column').forEach(col=>{
  col.addEventListener('dragover', e=>e.preventDefault());
  col.addEventListener('drop', e=>{
    if(!draggedCard) return;
    col.appendChild(draggedCard);
    const id = draggedCard.dataset.id;
    const clientes = getClientes().map(c=>c.id===id?{...c,status:col.id}:c);
    saveClientes(clientes);
    render();
    showToast("Status atualizado");
  });
});

/* ==== Filtro/Busca ==== */
searchInput.oninput = filtragemAplicada;
filterStatus.onchange = filtragemAplicada;
function filtragemAplicada(){
  const search = searchInput.value.toLowerCase();
  const filter = filterStatus.value;
  Object.values(cardsMap).forEach(card=>{
    const matchSearch = card.dataset.nome.includes(search);
    const matchFilter = !filter || card.dataset.status===filter;
    card.style.display = (matchSearch && matchFilter) ? 'block' : 'none';
  });
}

/* ==== Init ==== */
btnAdd.onclick=()=>openModal();
btnCancel.onclick=()=>closeModal();
modalBackdrop.onclick=e=>{if(e.target===modalBackdrop)closeModal();};
render();
</script>
</body>
</html>
