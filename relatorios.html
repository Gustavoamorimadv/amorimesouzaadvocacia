<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Relat√≥rios - AMR ADV</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root{
    --bg:#f7f8fa;
    --card:#ffffff;
    --accent:#1e1e2f;
    --muted:#6b7280;
    --border:#e6e9ee;
  }
  *{box-sizing:border-box;margin:0;padding:0;font-family:Inter, "Segoe UI", Roboto, sans-serif}
  body{background:var(--bg);min-height:100vh;display:flex;gap:20px}
  /* sidebar */
  .sidebar{width:220px;background:var(--card);border-right:1px solid rgba(0,0,0,.04);padding:20px 12px;flex-shrink:0}
  .brand{font-family:'Poppins',sans-serif;font-weight:600;color:var(--accent);font-size:18px;cursor:pointer;margin-bottom:18px}
  .sidebar button{display:block;width:100%;text-align:left;padding:10px 12px;border-radius:8px;border:0;background:transparent;color:var(--muted);cursor:pointer;margin-bottom:8px}
  .sidebar button:hover{background:#fafbfc;color:var(--accent)}
  /* main */
  .main{flex:1;display:flex;flex-direction:column;min-height:100vh}
  header{height:72px;background:var(--card);display:flex;align-items:center;justify-content:space-between;padding:0 20px;border-bottom:1px solid rgba(0,0,0,.04)}
  header h1{font-family:'Poppins',sans-serif;color:var(--accent);font-size:20px}
  .btn{padding:8px 12px;border-radius:8px;border:0;cursor:pointer;background:var(--accent);color:#fff}
  .btn.ghost{background:transparent;color:var(--accent);border:1px solid var(--border)}
  .content{padding:20px;overflow:auto}
  /* form */
  .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 8px 30px rgba(16,24,40,0.04);margin-bottom:18px}
  form.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;align-items:end}
  form input, form select{padding:10px;border-radius:8px;border:1px solid var(--border);background:transparent}
  form .full{grid-column:1/-1;display:flex;justify-content:flex-end;gap:8px}
  /* table */
  .table-wrap{overflow:auto}
  table{width:100%;border-collapse:collapse;background:var(--card);border-radius:10px;overflow:hidden;box-shadow:0 8px 24px rgba(16,24,40,0.04)}
  thead th{padding:12px;text-align:left;font-weight:600;color:var(--muted);border-bottom:1px solid var(--border)}
  tbody td{padding:12px;border-bottom:1px solid #f3f4f6;color:#333;vertical-align:middle}
  .muted{color:var(--muted);font-size:13px}
  .row-actions{display:flex;gap:8px;align-items:center;justify-content:flex-end}
  /* icon buttons */
  .icon-btn{width:32px;height:32px;border-radius:8px;display:inline-flex;align-items:center;justify-content:center;border:1px solid var(--border);cursor:pointer;background:#fff}
  .icon-btn:hover{background:#f0f0f0}
  .icon-btn svg{width:16px;height:16px;display:block}
  /* chart */
  #chartBox{margin-top:18px;height:380px;background:var(--card);padding:16px;border-radius:12px;box-shadow:0 8px 30px rgba(16,24,40,0.04);display:flex;flex-direction:column}
  #pagamentosChart{flex:1}
  .totals {display:flex;gap:16px;align-items:center;margin-bottom:10px;flex-wrap:wrap}
  .total-box{background:#fafafa;padding:10px 12px;border-radius:10px;border:1px solid var(--border);font-weight:600;color:var(--accent)}
</style>
</head>
<body>

  <aside class="sidebar">
    <div class="brand" onclick="location.href='crm.html'">AMR ADV</div>
    <button onclick="location.href='crm.html'">CRM</button>
    <button onclick="location.href='relatorios.html'">Relat√≥rios</button>
    <button onclick="location.href='agenda.html'">Agenda</button>
    <button>Contatos</button>
  </aside>

  <main class="main">
    <header>
      <h1>Relat√≥rios Financeiros</h1>
      <button class="btn" id="btnNovo">Novo Cliente</button>
    </header>

    <div class="content">

      <!-- FORM -->
      <section class="card" id="formCard">
        <form id="clienteForm" class="grid" autocomplete="off">
          <input type="text" id="nomeCliente" placeholder="Nome do cliente" required>
          <input type="number" id="honorarios" placeholder="Honor√°rios (R$)" min="0" step="0.01" required>
          <input type="number" id="valorPago" placeholder="Valor Pago (R$)" min="0" step="0.01" required>
          <input type="number" id="valorReceber" placeholder="Valor a Receber (R$)" min="0" step="0.01" required>
          <select id="statusCliente">
            <option value="N√£o iniciado">N√£o iniciado</option>
            <option value="Em andamento">Em andamento</option>
            <option value="Conclu√≠do">Conclu√≠do</option>
          </select>
          <div class="full">
            <button type="button" class="btn ghost" id="btnCancelar" style="display:none">Cancelar</button>
            <button type="submit" class="btn" id="btnSalvar">Adicionar</button>
          </div>
        </form>
      </section>

      <!-- TABELA -->
      <section class="card table-wrap">
        <table>
          <thead>
            <tr>
              <th>Cliente</th>
              <th>Honor√°rios</th>
              <th>Pago</th>
              <th>A Receber</th>
              <th>Status</th>
              <th style="text-align:right">A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="clientesTable"></tbody>
        </table>
      </section>

      <!-- GR√ÅFICO -->
      <section id="chartBox" class="card">
        <div class="totals">
          <div class="total-box" id="totalReceberBox">Total a Receber: R$ 0,00</div>
          <div class="total-box" id="totalHonorariosBox">Total Honor√°rios: R$ 0,00</div>
        </div>
        <canvas id="pagamentosChart"></canvas>
      </section>
    </div>
  </main>

<script>
(() => {
  const STORAGE_KEY = 'rel_clientes_v1';
  let clientes = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

  const form = document.getElementById('clienteForm');
  const tabela = document.getElementById('clientesTable');
  const ctx = document.getElementById('pagamentosChart').getContext('2d');
  const totalReceberBox = document.getElementById('totalReceberBox');
  const totalHonorariosBox = document.getElementById('totalHonorariosBox');

  const chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: [],
      datasets: [
        { label: 'üí∞ Honor√°rios', data: [], backgroundColor: '#facc15', stack: 'Stack 1' },
        { label: '‚úÖ Pago', data: [], backgroundColor: '#4ade80', stack: 'Stack 1' },
        { label: 'üìâ A Receber', data: [], backgroundColor: '#60a5fa', stack: 'Stack 1' }
      ]
    },
    options: {
      maintainAspectRatio: false,
      responsive: true,
      plugins: { legend: { position: 'top' } },
      scales: {
        x: { stacked: true },
        y: { stacked: true, beginAtZero: true, ticks: { callback: v => 'R$ ' + Number(v).toLocaleString('pt-BR') } }
      }
    }
  });

  function fmt(v){ return 'R$ ' + Number(v || 0).toLocaleString('pt-BR',{minimumFractionDigits:2}); }
  function saveAll(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(clientes)); }

  function render(){
    tabela.innerHTML='';
    clientes.forEach(c=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${c.nome}</td>
        <td>${fmt(c.honorarios)}</td>
        <td>${fmt(c.valorPago)}</td>
        <td>${fmt(c.valorReceber)}</td>
        <td>${c.status}</td>
        <td style="text-align:right"><button class="icon-btn" onclick="delCliente('${c.id}')">üóë</button></td>`;
      tabela.appendChild(tr);
    });

    chart.data.labels=clientes.map(c=>c.nome);
    chart.data.datasets[0].data=clientes.map(c=>c.honorarios);
    chart.data.datasets[1].data=clientes.map(c=>c.valorPago);
    chart.data.datasets[2].data=clientes.map(c=>c.valorReceber);
    chart.update();

    totalReceberBox.textContent = "Total a Receber: " + fmt(clientes.reduce((t,c)=>t+c.valorReceber,0));
    totalHonorariosBox.textContent = "Total Honor√°rios: " + fmt(clientes.reduce((t,c)=>t+c.honorarios,0));
  }

  form.addEventListener('submit',e=>{
    e.preventDefault();
    clientes.push({
      id:String(Date.now()),
      nome:form.nomeCliente.value,
      honorarios:+form.honorarios.value,
      valorPago:+form.valorPago.value,
      valorReceber:+form.valorReceber.value,
      status:form.statusCliente.value
    });
    saveAll();
    form.reset();
    render();
  });

  window.delCliente=id=>{
    clientes=clientes.filter(c=>c.id!==id);
    saveAll();render();
  };

  render();
})();
</script>
</body>
</html>
